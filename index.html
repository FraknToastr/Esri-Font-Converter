<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESRI Font Symbol Exporter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a202c;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #2d3748;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            padding: 40px;
        }

        h1 {
            color: #e2e8f0;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .loading-banner {
            background: #4a5568;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            color: #e2e8f0;
        }

        .loading-banner.success {
            background: #2f855a;
            color: white;
        }

        .load-font-btn {
            padding: 12px 24px;
            font-size: 1em;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .load-font-btn:hover {
            background: #38a169;
        }

        .font-instructions {
            color: #cbd5e0;
            font-size: 0.9em;
            margin-top: 12px;
        }

        .font-path-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .font-path {
            background: #1a202c;
            color: #48bb78;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .copy-path-btn {
            background: #4a5568;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
        }

        .copy-path-btn:hover {
            background: #667eea;
        }

        .copy-path-btn.copied {
            background: #48bb78;
        }

        .input-section {
            background: #1a202c;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #e2e8f0;
            font-weight: 600;
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #4a5568;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        input::placeholder {
            color: #718096;
        }

        #fontSearch {
            padding-right: 90px;
        }

        .clear-font-btn {
            position: absolute;
            right: 12px;
            top: 38px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            z-index: 100;
        }

        .clear-font-btn:hover {
            background: #5568d3;
        }

        .input-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
        }

        .toggle-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toggle-btn {
            flex: 1;
            padding: 10px 20px;
            border: 2px solid #4a5568;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-download {
            background: #48bb78;
            color: white;
        }

        .btn-download:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
        }

        .btn-download:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
        }

        .preview-section {
            margin-top: 30px;
        }

        .preview-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 15px;
        }

        .preview-box {
            background: #1a202c;
            border: 2px dashed #4a5568;
            border-radius: 12px;
            min-height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .preview-content {
            text-align: center;
            width: 100%;
        }

        .symbol-preview {
            font-size: 140px;
            line-height: 1;
            margin-bottom: 40px;
            color: #e2e8f0;
        }

        .symbol-info {
            color: #a0aec0;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .empty-state {
            color: #718096;
            font-size: 1.1em;
        }

        .font-dropdown {
            position: absolute;
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
            margin-top: 5px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .font-option {
            padding: 12px 15px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #2d3748;
            color: #e2e8f0;
        }

        .font-option:hover {
            background: #2d3748;
        }

        .no-results {
            padding: 15px;
            text-align: center;
            color: #718096;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .input-row {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ArcGIS Font Symbol Exporter</h1>

        <div id="loadingBanner" class="loading-banner">
            <button class="load-font-btn" onclick="loadArcGISFonts()">Load CoA ArcGIS Fonts</button>
            <input type="file" id="fontFileInput" accept=".ttf,.otf" multiple style="display: none;">
            <div class="font-instructions">
                Click button above, then navigate to:
            </div>
            <div class="font-path-container">
                <div class="font-path">C:\Program Files\ArcGIS\Pro\Resources\Fonts</div>
                <button class="copy-path-btn" onclick="copyFontPath()">Copy</button>
            </div>
            <div class="font-instructions" style="margin-top: 8px;">
                Select all font files (Ctrl+A) and click Open
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="fontSearch">Select ESRI Font <span id="fontCount"></span></label>
                <input type="text" id="fontSearch" placeholder="Search fonts..." autocomplete="off">
                <button class="clear-font-btn" id="clearFontBtn" onclick="clearFontSelection()" style="display: none;">Clear</button>
                <div id="fontDropdown" class="font-dropdown" style="display: none;"></div>
                <input type="hidden" id="fontSelect">
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label for="keyInput">Key Character</label>
                    <input type="text" id="keyInput" placeholder="e.g., A, !, Space" maxlength="10">
                </div>

                <div class="input-group">
                    <label for="decimalInput">Decimal Code</label>
                    <input type="number" id="decimalInput" placeholder="e.g., 65" min="0" max="65535">
                </div>

                <div class="input-group">
                    <label for="hexInput">Hex Code</label>
                    <input type="text" id="hexInput" placeholder="e.g., 41" maxlength="4">
                </div>
            </div>

            <div class="input-group">
                <label>Export Format</label>
                <div class="toggle-group">
                    <button class="toggle-btn active" data-format="svg">SVG</button>
                    <button class="toggle-btn" data-format="png">PNG</button>
                </div>
            </div>

            <div class="input-group" id="pngOptions" style="display: none;">
                <label for="sizeInput">PNG Size (pixels)</label>
                <input type="number" id="sizeInput" value="512" min="64" max="2048" step="64">
            </div>

            <div class="action-buttons">
                <button class="btn-generate" onclick="generatePreview()">Generate Preview</button>
                <button class="btn-download" id="downloadBtn" disabled onclick="downloadSymbol()">Download Symbol</button>
            </div>
        </div>

        <div class="preview-section">
            <div class="preview-title">Preview</div>
            <div class="preview-box" id="previewBox">
                <div class="empty-state">Enter a character code and click "Generate Preview"</div>
            </div>
        </div>
    </div>

    <script>
        const knownEsriFonts = [
            'ESRI Accident', 'ESRI ADS-1', 'ESRI ADS-2', 'ESRI ADS-3',
            'ESRI AMFM Electric', 'ESRI AMFM Gas', 'ESRI AMFM Sewer', 'ESRI AMFM Water',
            'ESRI ArcPad', 'ESRI Arrowhead', 'ESRI Business', 'ESRI Cartography',
            'ESRI Caves 1', 'ESRI Caves 2', 'ESRI Caves 3', 'ESRI Climate & Precipitation',
            'ESRI Commodities', 'ESRI Conservation', 'ESRI Crime Analysis',
            'ESRI Default Marker', 'ESRI Dimensioning', 'ESRI Environmental & Icons',
            'ESRI Flags', 'ESRI Geometric Symbols', 'ESRI Geology',
            'ESRI Hydrants', 'ESRI North', 'ESRI Oil, Gas, & Water',
            'ESRI Pipeline US 1', 'ESRI Plates', 'ESRI Public1', 'ESRI Residential',
            'ESRI Shields & Highway Signs', 'ESRI Telecom', 'ESRI Transportation & Civic',
            'ESRI Triangles', 'ESRI US MUTCD 1', 'ESRI US MUTCD 2', 'ESRI US MUTCD 3',
            'ESRI Valves 1', 'ESRI Water', 'ESRI Weather'
        ];

        let installedFonts = [];
        let loadedFontFiles = {};
        let currentFormat = 'svg';
        let currentCharCode = null;
        let currentFont = null;

        const fontSearch = document.getElementById('fontSearch');
        const fontDropdown = document.getElementById('fontDropdown');
        const fontSelect = document.getElementById('fontSelect');
        const clearFontBtn = document.getElementById('clearFontBtn');

        function copyFontPath() {
            const path = 'C:\\Program Files\\ArcGIS\\Pro\\Resources\\Fonts';
            navigator.clipboard.writeText(path).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('Could not copy to clipboard');
            });
        }

        function populateFontDropdown(filterText = '') {
            const filtered = installedFonts.filter(font => 
                font.toLowerCase().includes(filterText.toLowerCase())
            );

            if (filtered.length === 0) {
                fontDropdown.innerHTML = '<div class="no-results">No fonts found</div>';
            } else {
                fontDropdown.innerHTML = filtered.map(font => 
                    `<div class="font-option" data-font="${font}">${font}</div>`
                ).join('');

                document.querySelectorAll('.font-option').forEach(option => {
                    option.addEventListener('click', function() {
                        selectFont(this.dataset.font);
                    });
                });
            }
        }

        function selectFont(fontName) {
            fontSearch.value = fontName;
            fontSelect.value = fontName;
            currentFont = fontName;
            fontDropdown.style.display = 'none';
            clearFontBtn.style.display = 'block';
        }

        function clearFontSelection() {
            fontSearch.value = '';
            fontSelect.value = '';
            currentFont = null;
            clearFontBtn.style.display = 'none';
            populateFontDropdown('');
            fontDropdown.style.display = 'block';
            fontSearch.focus();
        }

        fontSearch.addEventListener('focus', function() {
            populateFontDropdown(this.value);
            fontDropdown.style.display = 'block';
        });

        fontSearch.addEventListener('input', function() {
            populateFontDropdown(this.value);
            fontDropdown.style.display = 'block';
            if (this.value && fontSelect.value) {
                clearFontBtn.style.display = 'block';
            }
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.input-group')) {
                fontDropdown.style.display = 'none';
            }
        });

        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFormat = this.dataset.format;
                document.getElementById('pngOptions').style.display = 
                    currentFormat === 'png' ? 'block' : 'none';
            });
        });

        const keyInput = document.getElementById('keyInput');
        const decimalInput = document.getElementById('decimalInput');
        const hexInput = document.getElementById('hexInput');

        keyInput.addEventListener('input', function() {
            if (this.value) {
                let code = this.value.toLowerCase() === 'space' ? 32 : this.value.charCodeAt(0);
                decimalInput.value = code;
                hexInput.value = code.toString(16).toUpperCase();
            }
        });

        decimalInput.addEventListener('input', function() {
            if (this.value) {
                const code = parseInt(this.value);
                if (code >= 0 && code <= 65535) {
                    hexInput.value = code.toString(16).toUpperCase();
                    keyInput.value = code === 32 ? 'Space' : 
                                   (code >= 33 && code <= 126) ? String.fromCharCode(code) : 
                                   `U+${code.toString(16).toUpperCase()}`;
                }
            }
        });

        hexInput.addEventListener('input', function() {
            if (this.value) {
                const code = parseInt(this.value, 16);
                if (!isNaN(code)) {
                    decimalInput.value = code;
                    keyInput.value = code === 32 ? 'Space' : 
                                   (code >= 33 && code <= 126) ? String.fromCharCode(code) : 
                                   `U+${code.toString(16).toUpperCase()}`;
                }
            }
        });

        function generatePreview() {
            const selectedFont = fontSelect.value;
            const decimalCode = parseInt(decimalInput.value);
            
            if (!selectedFont) {
                alert('Please select a font');
                return;
            }
            
            if (!decimalCode || isNaN(decimalCode)) {
                alert('Please enter a valid character code');
                return;
            }

            currentFont = selectedFont;
            currentCharCode = decimalCode;
            
            const character = String.fromCharCode(decimalCode);
            const previewBox = document.getElementById('previewBox');
            
            previewBox.innerHTML = `
                <div class="preview-content">
                    <div class="symbol-preview" style="font-family: '${currentFont}', sans-serif;">${character}</div>
                    <div class="symbol-info">
                        <strong>Character:</strong> ${keyInput.value}<br><br>
                        <strong>Decimal:</strong> ${decimalCode} | <strong>Hex:</strong> 0x${decimalCode.toString(16).toUpperCase()}<br><br>
                        <strong>Font:</strong> ${currentFont}
                    </div>
                </div>
            `;
            
            document.getElementById('downloadBtn').disabled = false;
        }

        function downloadSymbol() {
            if (!currentCharCode || !currentFont) {
                alert('Please generate a preview first');
                return;
            }

            const character = String.fromCharCode(currentCharCode);
            const filename = `${currentFont.replace(/\s+/g, '_')}_${currentCharCode}`;

            if (currentFormat === 'svg') {
                downloadSVG(character, filename);
            } else {
                downloadPNG(character, filename);
            }
        }

        function downloadSVG(character, filename) {
            const size = 512;
            
            if (!loadedFontFiles[currentFont]) {
                alert('Error: Font data not found. Please reload the font.');
                return;
            }
            
            const fontData = loadedFontFiles[currentFont].data;
            const uint8Array = new Uint8Array(fontData);
            let binaryString = '';
            for (let i = 0; i < uint8Array.length; i++) {
                binaryString += String.fromCharCode(uint8Array[i]);
            }
            const base64Font = btoa(binaryString);
            
            const svg = `<?xml version="1.0" encoding="UTF-8"?>
<svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style type="text/css">
      @font-face {
        font-family: "EmbeddedESRI";
        src: url("data:font/truetype;base64,${base64Font}") format("truetype");
      }
    </style>
  </defs>
  <rect width="${size}" height="${size}" fill="transparent"/>
  <text x="50%" y="55%" 
        font-family="EmbeddedESRI" 
        font-size="${size * 0.75}" 
        text-anchor="middle" 
        dominant-baseline="middle"
        fill="black">${character}</text>
</svg>`;

            const blob = new Blob([svg], { type: 'image/svg+xml' });
            downloadBlob(blob, filename + '.svg');
        }

        async function downloadPNG(character, filename) {
            const size = parseInt(document.getElementById('sizeInput').value) || 512;
            
            if (!loadedFontFiles[currentFont]) {
                alert('Error: Font data not found. Please reload the font.');
                return;
            }
            
            await document.fonts.ready;
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, size, size);
            ctx.font = `${size * 0.75}px "${currentFont}"`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = 'black';
            ctx.fillText(character, size / 2, size * 0.55);

            canvas.toBlob(function(blob) {
                downloadBlob(blob, filename + '.png');
            });
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function loadFontFiles(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            const loadingBanner = document.getElementById('loadingBanner');
            loadingBanner.innerHTML = `Loading ${files.length} font files...`;

            let successCount = 0;
            const newFonts = [];

            for (const file of files) {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const fontName = file.name.replace(/\.(ttf|otf)$/i, '');
                    
                    const fontFace = new FontFace(fontName, arrayBuffer);
                    await fontFace.load();
                    document.fonts.add(fontFace);
                    
                    loadedFontFiles[fontName] = {
                        data: arrayBuffer,
                        fileName: file.name,
                        fontFace: fontFace
                    };
                    
                    newFonts.push(fontName);
                    successCount++;
                } catch (error) {
                    console.error(`Failed to load ${file.name}:`, error);
                }
            }

            installedFonts = [...new Set([...installedFonts, ...newFonts])].sort();
            
            loadingBanner.innerHTML = `<button class="load-font-btn" onclick="loadArcGISFonts()">Load CoA ArcGIS Fonts</button>
            <div style="color: #48bb78; margin-top: 15px; font-weight: 600;">✓ Loaded ${successCount} fonts successfully!</div>`;
            document.getElementById('fontCount').textContent = `(${installedFonts.length} available)`;
        }

        function loadArcGISFonts() {
            document.getElementById('fontFileInput').click();
        }

        window.addEventListener('load', function() {
            document.getElementById('fontFileInput').addEventListener('change', loadFontFiles);
        });
    </script>
</body>
</html>
